import{j as s}from"./qr-DMA3LBFM.js";import{a as w,F as h,M as u,C as x,S as n,n as j,o,I as d,p as v,q as f,B as C}from"./antd-D61CRulc.js";import{w as P,j as N,A as b}from"./index-SOiojaBB.js";import"./viem-DzTeDfjp.js";import"./crypto-BdufoeM_.js";import"./react-Cudyqgo0.js";class y extends w.Component{constructor(e){super(e),this.state={selectedOption:"create",mnemonic:"",isLoading:!1,error:"",saving:!1,savingTimeout:null,passwordOption:"withPassword",password:"",confirmPassword:"",passwordVisible:!1}}handleOptionChange=e=>{this.setState({selectedOption:e.target.value})};handleLanguageChange=e=>{this.props.i18n.changeLanguage(e)};handleMnemonicChange=e=>{this.setState({mnemonic:e.target.value})};handleNext=async()=>{const{selectedOption:e,mnemonic:r,passwordOption:a,password:t,confirmPassword:l}=this.state;this.setState({isLoading:!0,error:"",saving:!0});try{if(a==="withPassword"){if(!t||t.length<8)throw new Error(this.props.t("passwordMinLength"));if(t!==l)throw new Error(this.props.t("passwordsNotMatch"))}const i=await N(e,r,a==="withPassword"?t:"");this.props.navigate&&this.props.navigate("/wallet",{state:{mnemonicSaved:!0}})}catch(i){console.error("处理钱包操作失败:",i),this.setState({error:i.message,saving:!1})}finally{this.setState({isLoading:!1})}};handlePasswordChange=e=>{this.setState({password:e.target.value})};handleConfirmPasswordChange=e=>{this.setState({confirmPassword:e.target.value})};togglePasswordVisibility=()=>{this.setState(e=>({passwordVisible:!e.passwordVisible}))};handlePasswordOptionChange=e=>{this.setState({passwordOption:e.target.value,password:"",confirmPassword:""})};componentWillUnmount(){this.state.savingTimeout&&clearTimeout(this.state.savingTimeout)}render(){const{selectedOption:e,mnemonic:r,isLoading:a,error:t,saving:l,passwordOption:i,password:p,confirmPassword:m,passwordVisible:c}=this.state,{i18n:g}=this.props;return s.jsxs(h,{className:"container",children:[s.jsx("h2",{children:this.props.t("welcomeToWallet")}),s.jsx(u,{title:this.props.t("saveMnemonic"),open:l,closable:!1,footer:null,className:"modal-overlay",children:s.jsxs("div",{className:"modal-content",children:[s.jsx("div",{className:"loading-spinner"}),s.jsx("p",{children:this.props.t("savingMnemonicPleaseConfirm")})]})}),s.jsx(x,{className:"section",children:s.jsxs(n,{direction:"vertical",className:"space_section",children:[s.jsxs(h,{style:{justifyContent:"space-between",alignItems:"center",width:"100%"},children:[s.jsx("h3",{children:this.props.t("pleaseSelectOperation")}),s.jsx(j,{value:g.language,onChange:this.handleLanguageChange,style:{width:120},options:b,allowClear:!1})]}),s.jsxs(o.Group,{value:e,onChange:this.handleOptionChange,disabled:a,children:[s.jsx(o,{value:"create",className:"radio-label",children:this.props.t("createNewWallet")}),s.jsx(o,{value:"import",className:"radio-label",children:this.props.t("importExistingWallet")})]}),e==="import"&&s.jsx(n,{direction:"vertical",className:"space_section",children:s.jsx(d.TextArea,{value:r,onChange:this.handleMnemonicChange,placeholder:this.props.t("enterMnemonicWithSpaces"),rows:4,className:"textarea",disabled:a})}),s.jsxs(n,{direction:"vertical",className:"space_section",children:[s.jsx("h3",{children:this.props.t("passwordOptions")}),s.jsxs(o.Group,{value:i,onChange:this.handlePasswordOptionChange,disabled:a,children:[s.jsx(o,{value:"withPassword",className:"radio-label",children:this.props.t("encryptMnemonicWithPassword")}),s.jsx(o,{value:"withoutPassword",className:"radio-label",children:this.props.t("doNotUsePassword")})]}),i==="withPassword"?s.jsxs(n,{direction:"vertical",className:"space_section",children:[s.jsx("p",{className:"security-tip",children:this.props.t("encryptionAdvice")}),s.jsx(d,{type:c?"text":"password",value:p,onChange:this.handlePasswordChange,placeholder:this.props.t("setPasswordAtLeast8Chars"),disabled:a,suffix:s.jsx("button",{type:"button",onClick:this.togglePasswordVisibility,className:"eye-icon-button",disabled:a,style:{background:"none",border:"none",padding:"0px",cursor:"pointer",color:"rgba(0, 0, 0, 0.45)"},children:c?s.jsx(v,{}):s.jsx(f,{})})}),s.jsx(d,{type:"password",value:m,onChange:this.handleConfirmPasswordChange,placeholder:this.props.t("confirmPassword"),disabled:a})]}):s.jsx(n,{direction:"vertical",className:"space_section",children:s.jsx("p",{className:"warning-tip",children:this.props.t("noPasswordWarning")})})]}),t&&s.jsx("p",{className:"error-message",children:t}),s.jsx(C,{onClick:this.handleNext,type:"primary",loading:a,children:this.props.t("nextStep")})]})})]})}}const V=P()(y);export{V as default};
