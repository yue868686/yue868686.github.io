import{j as e,Q as M}from"./qr-DMA3LBFM.js";import{a as j,M as l,s as c,I as h,t as x,F as I,C as E,S as g,B as p,n as v,v as D}from"./antd-D61CRulc.js";import{w as F,g as m,a as k,k as b,l as u,m as T,r as A,s as S,b as B,n as U,o as w,p as V,q as L,t as O,A as R}from"./index-SOiojaBB.js";import"./viem-DzTeDfjp.js";import"./crypto-BdufoeM_.js";import"./react-Cudyqgo0.js";class q extends j.Component{constructor(t){super(t),this.state={walletAddress:"",blockchainModalVisible:!1,selectedChain:null,selectedCoin:null,availableChains:[],availableCoins:[],customChainModalVisible:!1,qrCodeModalVisible:!1},this.customChainForm=j.createRef(),this.customCoinForm=j.createRef()}handleLanguageChange=t=>{this.props.i18n.changeLanguage(t)};componentDidMount(){this.fetchWalletAddress(),this.loadBlockchainSettings(),window.addEventListener("popstate",this.handlePopState),window.history.pushState({fromSettings:!0},"",window.location.href)}componentWillUnmount(){window.removeEventListener("popstate",this.handlePopState)}handlePopState=t=>{t.preventDefault(),this.handleBack()};loadBlockchainSettings=()=>{try{const t=m(),s=k(),a=b(),o=u();this.setState({selectedChain:t,selectedCoin:s,availableChains:a,availableCoins:o})}catch(t){console.error("加载区块链设置失败:",t)}};handleOpenCustomCoinModal=()=>{this.customCoinForm.current&&this.customCoinForm.current.resetFields(),l.confirm({title:this.props.t("addCustomCoin"),content:e.jsxs(c,{ref:this.customCoinForm,layout:"vertical",children:[e.jsx(c.Item,{name:"name",label:this.props.t("coinName"),rules:[{required:!0,message:this.props.t("pleaseEnterCoinName")}],children:e.jsx(h,{placeholder:"E.g.: USDC"})}),e.jsx(c.Item,{label:this.props.t("decimalPrecision"),name:"decimals",initialValue:"18",rules:[{required:!0,message:this.props.t("pleaseEnterDecimalPrecision")},{pattern:/^\d+$/,message:this.props.t("decimalPrecisionMustBeInteger")}],children:e.jsx(h,{placeholder:"18"})}),e.jsx(c.Item,{name:"address",label:this.props.t("contractAddress"),rules:[{required:!0,message:this.props.t("pleaseEnterContractAddress")},{pattern:/^0x[a-fA-F0-9]{40}$/,message:this.props.t("pleaseEnterValidEthereumContractAddress")}],children:e.jsx(h,{placeholder:"E.g.: 0x75faf114eafb1BDbe2F0316DF893fd58CE46AA4d"})})]}),okText:this.props.t("add"),cancelText:this.props.t("cancel"),width:500,onOk:async()=>{try{const t=this.customCoinForm.current;if(!t)return;const s=await t.validateFields(),o={chainId:m().id,name:s.name,symbol:s.name.toUpperCase(),decimals:parseInt(s.decimals,10),address:s.address.trim()};await T(o);const i=u();this.setState({availableCoins:i}),l.success({title:this.props.t("addSuccess"),content:this.props.t("successfullyAddedCoin",{coinName:s.name})}),this.loadBlockchainSettings()}catch(t){l.error({title:this.props.t("addFailed"),content:t.message||this.props.t("errorAddingCoin")})}},onCancel:()=>{}})};handleOpenDeleteCustomCoinModal=()=>{const t=m(),s=this.state.availableCoins.filter(i=>i.isCustom);if(s.length===0){l.info({title:this.props.t("prompt"),content:this.props.t("noCustomCoins")});return}const a=k(),o=l.confirm({title:this.props.t("deleteCustomCoin"),content:e.jsxs("div",{children:[e.jsx("p",{style:{marginBottom:"12px"},children:this.props.t("selectCustomCoinsToDelete")}),s.map(i=>e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"8px",padding:"4px",border:a&&a.address===i.address?"1px solid #ff4d4f":"1px solid transparent",borderRadius:"4px"},children:[e.jsx("input",{type:"checkbox",id:`delete-coin-${i.address}`,style:{marginRight:"8px"}}),e.jsxs("label",{htmlFor:`delete-coin-${i.address}`,children:[e.jsxs("span",{style:{color:"green"},children:[i.name," (",i.symbol,")"]}),a&&a.address===i.address&&e.jsx("span",{style:{color:"#ff4d4f",marginLeft:"8px",fontSize:"12px"},children:this.props.t("currentlyUsed")})]})]},i.address))]}),okText:this.props.t("delete"),cancelText:this.props.t("cancel"),width:500,onOk:async()=>{try{const i=s.filter(r=>document.getElementById(`delete-coin-${r.address}`)?.checked).map(r=>r.address);if(i.length===0){l.warning({title:this.props.t("prompt"),content:this.props.t("pleaseSelectAtLeastOneCoin")}),setTimeout(()=>this.handleOpenDeleteCustomCoinModal(),500);return}const n=a&&i.includes(a.address);let C=[];for(const r of i){const d=s.find(y=>y.address===r);d&&(await A(r,t.id),C.push(d.name))}const f=u();n&&S(null),this.setState({availableCoins:f}),l.success({title:this.props.t("deleteSuccess"),content:this.props.t("successfullyDeletedCoins",{coinNames:C.join("、")})}),this.loadBlockchainSettings()}catch(i){l.error({title:this.props.t("deleteFailed"),content:i.message||this.props.t("errorDeletingCoin")})}},onCancel:()=>{o.destroy()}})};fetchWalletAddress=async()=>{try{const t=await B();this.setState({walletAddress:t})}catch(t){console.error("获取钱包地址失败:",t)}};handleOpenQrCodeModal=()=>{this.setState({qrCodeModalVisible:!0})};handleCloseQrCodeModal=()=>{this.setState({qrCodeModalVisible:!1})};handleBack=()=>{this.props.navigate(-1),window.history.replaceState({fromSettings:!0},"",window.location.href)};handleOpenBlockchainModal=()=>{try{const t=m(),s=k(),a=u();this.setState({selectedChain:t,selectedCoin:s,availableCoins:a,blockchainModalVisible:!0})}catch(t){console.error("打开区块链设置弹窗失败:",t)}};handleCloseBlockchainModal=()=>{this.setState({blockchainModalVisible:!1})};handleOpenCustomChainModal=()=>{this.customChainForm.current&&this.customChainForm.current.resetFields(),this.setState({customChainModalVisible:!0})};handleCloseCustomChainModal=()=>{this.setState({customChainModalVisible:!1})};handleAddCustomChain=async()=>{try{if(!this.customChainForm.current)return;const t=await this.customChainForm.current.validateFields(),s=parseInt(t.id,10);if(isNaN(s)||s<0||!Number.isInteger(s)){l.error({title:this.props.t("inputError"),content:this.props.t("chainIdMustBeNonNegative")});return}try{new URL(t.rpcUrl)}catch{l.error({title:this.props.t("inputError"),content:this.props.t("rpcUrlFormatError")});return}const a=parseInt(t.currencyDecimals,10);if(isNaN(a)||a<0||a>255||!Number.isInteger(a)){l.error({title:this.props.t("inputError"),content:this.props.t("currencyDecimalsRangeError")});return}if(t.blockExplorerUrl)try{new URL(t.blockExplorerUrl)}catch{l.error({title:this.props.t("inputError"),content:this.props.t("blockExplorerUrlFormatError")});return}const o={id:s,name:t.name,nativeCurrency:{name:t.currencyName||"ETH",symbol:t.currencySymbol||"ETH",decimals:a},rpcUrls:{default:{http:[t.rpcUrl]}}};t.blockExplorerUrl&&(o.blockExplorers={default:{name:t.name+" Explorer",url:t.blockExplorerUrl}}),await U(o);const i=b();this.setState({availableChains:i,customChainModalVisible:!1}),l.success({title:this.props.t("addSuccess"),content:this.props.t("successfullyAddedChain",{chainName:t.name})})}catch(t){console.error("添加自定义链失败:",t),l.error({title:this.props.t("addFailed"),content:t.message||this.props.t("errorAddingChain")})}};handleChainChange=t=>{try{const s=this.state.availableChains.find(a=>a.id===t);if(s){w(s);const a=u();this.setState({selectedChain:s,selectedCoin:null,availableCoins:a}),this.fetchWalletAddress()}}catch(s){console.error("切换链失败:",s)}};handleCoinChange=t=>{try{if(t){const s=this.state.availableCoins.find(a=>a.address===t);S(s),this.setState({selectedCoin:s})}else S(null),this.setState({selectedCoin:null})}catch(s){console.error("切换币失败:",s)}};handleDeleteCustomChain=()=>{const s=b().filter(i=>i.isCustom);if(s.length===0){l.info({title:this.props.t("prompt"),content:this.props.t("noCustomChainsToDelete")});return}const a=m().id,o=l.confirm({title:this.props.t("deleteCustomChain"),content:e.jsxs("div",{children:[e.jsx("p",{style:{marginBottom:"12px"},children:this.props.t("selectCustomChainsToDelete")}),s.map(i=>e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"8px",padding:"4px",border:a===i.id?"1px solid #ff4d4f":"1px solid transparent",borderRadius:"4px"},children:[e.jsx("input",{type:"checkbox",id:`delete-chain-${i.id}`,style:{marginRight:"8px"}}),e.jsxs("label",{htmlFor:`delete-chain-${i.id}`,children:[e.jsx("span",{style:{color:"green"},children:i.name}),a===i.id&&e.jsxs("span",{style:{color:"#ff4d4f",marginLeft:"8px",fontSize:"12px"},children:["(",this.props.t("currentlyUsed"),")"]})]})]},i.id))]}),okText:this.props.t("delete"),cancelText:this.props.t("cancel"),width:500,onOk:async()=>{try{const i=s.filter(d=>document.getElementById(`delete-chain-${d.id}`)?.checked).map(d=>d.id);if(i.length===0){l.warning({title:this.props.t("prompt"),content:this.props.t("pleaseSelectAtLeastOneChain")}),setTimeout(()=>this.handleDeleteCustomChain(),500);return}const n=i.includes(a);let C=[];for(const d of i){const y=s.find(N=>N.id===d);y&&(await V(d),C.push(y.name))}const f=b();let r=m();if(n&&(r=f[0],r&&w(r)),this.setState({availableChains:f,selectedChain:r}),r){const d=u(r.id);this.setState({availableCoins:d})}l.success({title:this.props.t("deleteSuccess"),content:this.props.t("successfullyDeletedChains",{chainNames:C.join("、")})}),this.loadBlockchainSettings()}catch(i){l.error({title:this.props.t("deleteFailed"),content:i.message||this.props.t("errorDeletingChain")})}},onCancel:()=>{o.destroy()}})};handleSaveBlockchainSettings=()=>{if(!this.state.selectedChain){l.error({title:this.props.t("error"),content:this.props.t("pleaseSelectAtLeastOneChain")});return}this.setState({blockchainModalVisible:!1}),l.success({title:this.props.t("saveSuccess"),content:this.props.t("blockchainSettingsSaved")})};handleDeleteWallet=()=>{console.log("删除钱包前:"),l.confirm({title:this.props.t("confirmDeleteWallet"),content:this.props.t("deleteWalletMessage"),okText:this.props.t("confirm"),cancelText:this.props.t("cancel"),onOk:()=>{try{L(),O(),this.props.navigate&&this.props.navigate("/welcome")}catch(t){console.error("删除钱包失败:",t)}}})};render(){const{walletAddress:t,selectedChain:s}=this.state,{Title:a,Text:o}=x,{i18n:i}=this.props;return e.jsxs(I,{className:"container",children:[e.jsxs(E,{className:"section",children:[e.jsxs(g,{className:"space_section",children:[e.jsx(p,{type:"primary",onClick:this.handleBack,className:"small-btn",children:this.props.t("back")}),e.jsx(v,{value:i.language,onChange:this.handleLanguageChange,style:{width:120,marginLeft:"auto"},options:R,allowClear:!1})]}),e.jsx(g,{className:"space_section",children:e.jsx(a,{level:5,children:this.props.t("walletAddress")})}),e.jsxs(g,{className:"space_section",align:"center",wrap:!0,children:[e.jsx(o,{className:"address",style:{wordBreak:"break-all",maxWidth:"300px"},children:t}),e.jsx(p,{type:"primary",icon:e.jsx(D,{}),onClick:this.handleOpenQrCodeModal,disabled:!t,title:this.props.t("showQrCode"),className:"small-btn"})]}),e.jsx(g,{className:"space_section",children:e.jsx(p,{type:"default",onClick:this.handleOpenBlockchainModal,children:this.props.t("blockchainSettings")})}),e.jsx(g,{className:"space_section",children:e.jsx(p,{type:"default",danger:!0,onClick:this.handleDeleteWallet,children:this.props.t("deleteWallet")})})]}),e.jsx(l,{title:this.props.t("blockchainSettings"),open:this.state.blockchainModalVisible,footer:[e.jsx(p,{onClick:this.handleCloseBlockchainModal,children:this.props.t("close")},"close")],width:600,closable:!0,onCancel:this.handleCloseBlockchainModal,children:e.jsxs("div",{className:"blockchain-settings-container",children:[e.jsxs("div",{className:"setting-item",children:[e.jsx(x.Text,{className:"setting-label",children:this.props.t("selectChain")}),e.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[e.jsx(v,{className:"setting-select",placeholder:this.props.t("pleaseSelectChain"),value:this.state.selectedChain?.id,onChange:this.handleChainChange,style:{flex:1},options:this.state.availableChains.map(n=>({value:n.id,label:n.isCustom?e.jsx("span",{style:{color:"green"},children:n.name}):n.name})),allowClear:!1}),e.jsx(p,{type:"default",size:"small",onClick:this.handleOpenCustomChainModal,style:{width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center"},children:"+"}),e.jsx(p,{type:"default",size:"small",onClick:this.handleDeleteCustomChain,style:{width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center"},children:"-"})]})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx(x.Text,{className:"setting-label",children:this.props.t("selectCoin")}),e.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[e.jsxs("div",{style:{position:"relative",flex:1},children:[e.jsx(v,{className:"setting-select",placeholder:this.props.t("pleaseSelectCoin"),value:this.state.selectedCoin?.address||void 0,onChange:this.handleCoinChange,style:{width:"100%"},options:this.state.availableCoins.map(n=>({value:n.address,label:n.isCustom?e.jsx("span",{style:{color:"green"},children:n.name}):`${n.name}`})),allowClear:!1}),this.state.selectedCoin?.address&&e.jsx("button",{onClick:n=>{n.stopPropagation(),this.handleCoinChange(void 0)},style:{position:"absolute",right:"2px",top:"50%",transform:"translateY(-50%)",background:"white",border:"1px solid #d9d9d9",borderRadius:"4px",width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",zIndex:10,fontSize:"12px",color:"#8c8c8c"},"aria-label":"Clear selection",children:"✕"})]}),e.jsx(p,{type:"default",size:"small",onClick:this.handleOpenCustomCoinModal,disabled:typeof s?.id=="string"&&s?.id?.startsWith("btc"),style:{width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center"},children:"+"}),e.jsx(p,{type:"default",size:"small",onClick:this.handleOpenDeleteCustomCoinModal,disabled:typeof s?.id=="string"&&s?.id?.startsWith("btc"),style:{width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center"},children:"-"})]}),!this.state.availableCoins.length&&e.jsx(x.Text,{type:"secondary",style:{marginTop:"8px",display:"block"},children:this.props.t("noAvailableTokens")})]})]})}),e.jsx(l,{title:this.props.t("addCustomChain"),open:this.state.customChainModalVisible,onOk:this.handleAddCustomChain,onCancel:this.handleCloseCustomChainModal,okText:this.props.t("add"),cancelText:this.props.t("cancel"),width:600,children:e.jsxs(c,{ref:this.customChainForm,layout:"vertical",className:"custom-chain-form",children:[e.jsx(c.Item,{label:this.props.t("chainIdRequired"),name:"id",rules:[{required:!0,message:this.props.t("pleaseEnterChainId")},{pattern:/^\d+$/,message:this.props.t("chainIdMustBeNonNegative")}],children:e.jsx(h,{placeholder:"12345"})}),e.jsx(c.Item,{label:this.props.t("chainName"),name:"name",rules:[{required:!0,message:this.props.t("pleaseEnterChainName")},{min:2,max:50,message:this.props.t("chainNameLength")}],children:e.jsx(h,{placeholder:"Custom Network"})}),e.jsx(c.Item,{label:this.props.t("rpcUrlRequired"),name:"rpcUrl",rules:[{required:!0,message:this.props.t("pleaseEnterRpcUrl")},{type:"url",message:this.props.t("pleaseEnterValidUrl")}],children:e.jsx(h,{placeholder:"https://rpc.custom-network.com"})}),e.jsx(c.Item,{label:this.props.t("nativeCurrencyName"),name:"currencyName",initialValue:"Ether",rules:[{required:!0,message:this.props.t("pleaseEnterNativeCurrencyName")},{min:1,max:20,message:this.props.t("currencyNameLength")}],children:e.jsx(h,{placeholder:"Ether"})}),e.jsx(c.Item,{label:this.props.t("nativeCurrencySymbol"),name:"currencySymbol",initialValue:"ETH",rules:[{required:!0,message:this.props.t("pleaseEnterNativeCurrencySymbol")},{min:1,max:10,message:this.props.t("currencySymbolLength")}],children:e.jsx(h,{placeholder:"ETH"})}),e.jsx(c.Item,{label:this.props.t("nativeCurrencyDecimals"),name:"currencyDecimals",initialValue:"18",rules:[{required:!0,message:this.props.t("pleaseEnterNativeCurrencyDecimals")},{pattern:/^\d+$/,message:this.props.t("nativeCurrencyDecimalsMustBeInteger")}],children:e.jsx(h,{placeholder:"18"})}),e.jsx(c.Item,{label:this.props.t("explorerUrl"),name:"blockExplorerUrl",rules:[{type:"url",message:this.props.t("pleaseEnterValidUrl")}],children:e.jsx(h,{placeholder:"https://explorer.custom-network.com"})})]})}),e.jsx(l,{title:this.props.t("walletAddressQrCode"),open:this.state.qrCodeModalVisible,onCancel:this.handleCloseQrCodeModal,footer:[e.jsx(p,{onClick:this.handleCloseQrCodeModal,children:this.props.t("close")},"close")],width:300,closable:!0,children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px 0"},children:[t&&e.jsx(M,{value:t,size:200,level:"H"}),e.jsx(x.Text,{style:{marginTop:"16px",fontSize:"14px",wordBreak:"break-all"},children:t})]})})]})}}const G=F()(q);export{G as default};
